   SPICE ANALYSIS PARSER VERSION 1.0

   Usage dependent on grsisort classes (and subclasses)
   TSiLi, TSiLiHit, TRF, TS3, TS3Hit, TTigress, TTigressHit
   Built using ROOT 6.04/12
   Some minimal dependence on personal Jlibrary, easily patched out.

   All commands can be given either on the command line or by passing a command list file.
   Command list file is any plain text file named *.info
   The # mark at the start of a line comments out the line in an info file
   Command line inputs and info files can be combined. Info file can be nested 
   Usage: ./Aparser run.info
   Usage: ./Aparser files.info analysis37434.root gates.info

   No wildcards may be used, use command line inputs to make use of variable substitution
   e.g. ./Aparser $(echo analysis/analysis37434_*.root)


   Inputs:
	Data file -
		Any .root file containing "analysis" in the title.
		Any AnalysisTree contained will be added to the TChain for processing
		e.g. analysis****.root

	Output file -
		Any .root file NOT containing "analysis" or "gate" in the title.
		A default AparserOut.root will be created if not provided
		e.g. firstrun.root


	Calibration file -
		Any .cal file
		Values will be loaded from the AnalysisTree if not provided
		e.g. Calibration.cal


   -----------------------------------------------------
   Flags
   -----------------------------------------------------
   The following flags may be parsed to change default sort behaviour:
   
   NoSPICE - SPICE is not used. No SPICE histograms.
   UseFitCharge - All SiLi energies will be calculated from the waveform fit charge, if waveform fitting was enabled in grsisort
   Telescope - Sort S3 as dE (rings) E (sectors) telescope, not a single detector.
   UseSiLiRFCoinc - 2D SiLi-S3-RF time gates are used in determining SiLi-S3 coincidence.
   TigressSuppressed - Set Tigress detector positions to suppressed mode (backward)
   DoDoubleElectrons - Enable the creation and filling of double electron histograms
   TimeCompressOff - Use the absolute clock time, do not compress
   KeepChargeShare - Keep rather than discard S3 charge sharing events. NOT appropriate for telescope
   FirstOnly - Only fill particle coincident gamma and electron histograms once per gate type. i.e. 2p coincident gamma ray fills the p-gamma histogram only once.
   MultiParticles - Make special histograms for gamma and electron coincident with several particles.
   PreferenceSectors - Use the S3 sector energy where possible, worse resolution but strangely more stable
   AddMonitor - Show histogram of monitor detector, not correlated with experimental data.

   -----------------------------------------------------
   Set Numbers
   -----------------------------------------------------
   The following internal numbers can modified from there default value by passing their name followed by the new number:
   
   BetaZero    (A default experimental beta value =0.0)
   TigressDistance  (Tigress face distance =110.0, see also TigressSuppressed flag)
   FrontBackEnergy  (S3 ring sector gate, given as a fraction =0.9)
   FrontBackTime    (S3 ring sector gate, given in ticks =75)
   S3EnergyLimit    (Total energy range in keV for heavy ions =50000)
   SiLiWaveTOffset  (Offset relative to normal trigger cfd =7000)
   TigressTargetOffset (mm between centre of target and tigress=-8)
   SiLiNoiseLimit   (cut of limit to throw away spice events =0.15)
   SiLiSmirnovLimit (cut of limit to throw away spice events =500)
   
   MultiS3 # (Give the mnemonic array position of one of the S3s when there are multiple, call for each)

   S3Vector # # # (X Y Z mm offset of the S3 from the nominal position)
   
   If an argument matches none of the above it is assumed to be a gate name.
   
   -----------------------------------------------------
   Gain Drift
   -----------------------------------------------------
   The entire gain of SPICE can drift from run to run.
   Ideally shift should be dealt with channel by channel, but often there is insufficient data.
   To correct whole of SPICE energy provide a text file containing "run-number/file offset gain",
   Where offset and gain are adjustments of the already calibrated energy.
   File name should end "gaindrift.txt"
   
   e.g. newgaindrift.txt
   
   -----------------------------------------------------
   NOTES ON RF GATES
   -----------------------------------------------------

   As SPICE is mainly run with a coincidence trigger, RF gates are rarely useful (RF triggers are best for cleaning singles data.)
   Coincidence triggers are better for cleaning coincidence data without losing events that were genuine but not part of the trigger pair.  This is particularly true when some runs have high SPICE noise which may effect trigger, but still contain good events. The RF gates consequently are only used to fill a few RF specific histograms
   
   RF coincidence MAY be used for 2D gating SiLi-S3 where it has been found to be advantageous.
   
   -----------------------------------------------------
   1D Gates
   -----------------------------------------------------
   Immediately following the the gate name the upper and lower limits must be passed, this enables the gate in the appropriate part of the sort
   e.g. rf_gamma -15 15
   
   The following gates exist at the time of writing:
   s3_gamma_t, s3_sili_t, gamma_gamma_t, sili_sili_t, gamma_sili_t, rf_S3, rf_sili, rf_gamma

   -----------------------------------------------------
   2D Particle Gates
   -----------------------------------------------------
   
   Lines starting "s3_rs_2D" add data to a particle gate on the S3 detector, either dE-E or E-theta depending on the Telescope flag.  
   "s3_rs_2D" should be concatenated with an index starting at zero to designate the gate e.g. s3_rs_2D0

   Next a type specifier should be given followed by input data.
   The following specifiers exist:
   title STRING - the title to use when saving the gate and associated histograms [title]
   gate # # - A point of the gate [X,Y]
   theta # # - A point of angle map for a binary reaction particle of interest [ThetaDetcted,ThetaOther]
   beta # # - A point of beta vs angle map [Theta,beta]
   ring # # - The beta value to use for a specified S3 ring [Ring,theta]
   MS3 # - When there are multiple S3 limit this gate to only s3 with mnemonic array position #, may add multiple with repeat commands.
   UseEnergyBeta # - Calculate beta from the detected energy using the given mass #
   
   e.g.
   s3_rs_2D0 title protons
   s3_rs_2D0 gate 6812 3556.14
   s3_rs_2D0 gate 8065.76 3022.72
   s3_rs_2D0 gate 9297.68 2654.04
   s3_rs_2D0 beta 0 0.05
   s3_rs_2D0 beta 0.1 0.04
   s3_rs_2D0 beta 0.5 0.03  
   
   OR gates can be loaded from files:
    
   gatefile *.root - A file containing a TGraph for the gate
   thetafile *.root - A file containing a TGraph for angle map for a binary particle of interest
   betafile *.root - A file containing a TGraph for beta vs angle map
   (File name should contain "gate" else it may be overwritten by histogram output!)
   
   e.g.
   s3_rs_2D1 title alpha
   s3_rs_2D1 gatefile alphagate.root
   
   If a mix of "beta" AND "ring" inputs are given the ring values will be used for kinematic adjustment

   In a binary reaction one may wish to gate on one particle and kinematically correct based on the other.
   In this case specify "gate" inputs for the gate particle "beta" inputs for the other particle and 
   "theta" to specify a kinematic relation between the two (x the gate particle, y the correcting particle)
   If the curve has multiple solutions (i.e. inverse kinematics) these should be separated into multiple s3_rs_2D gates
   When the beta inputs are given the angle is the detected angle regardless of which particle is being corrected.

   -----------------------------------------------------
   Ring Groups
   -----------------------------------------------------
   
   In addition to particle gates one may wish to divide the data by S3 ring groups i.e. for Coulex
   This subdivision is done nested inside S3 particle gates:
   
   RingGroup inner outer
   
   e.g.
   RingGroup 0 4
   
   Note: With multiple S3s the ring numbering convention is a little odd.
   It defined in order mnemonic array position number.
   E.g. Position 2 & 3 used: First ring of 2 = 0, First ring of 3 = 24 etc.
   
   -----------------------------------------------------
   2D SPICE s3 RF gate
   -----------------------------------------------------
   
   Lines starting "s3silirf2D" add data to a time gate for SPICE S3 coincidence with respect to the RF
   "s3silirf2D" should be concatenated with an index starting at zero to designate the gate e.g. s3silirf2D0
   and followed by the x & y point of the gate

   e.g.
   s3silirf2D0 -100.3 50.1
   s3silirf2D0 -100.3 -40.9
   s3silirf2D0 60.1 10.1
   
   (S3 SiLi RF time gates are only used with the UseSiLiRFCoinc flag)
